# åŒæ­¥Notionç³»ç»Ÿ (SyncToNotion)

åŸºäº Cloudflare Workers çš„æ™ºèƒ½å†…å®¹è§£æä¸ Notion åŒæ­¥ç³»ç»Ÿï¼Œæ”¯æŒå°çº¢ä¹¦å’ŒæŠ–éŸ³å†…å®¹çš„è‡ªåŠ¨åŒ–å¤„ç†ä¸åŒæ­¥ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ” å¤šå¹³å°å†…å®¹è§£æ
- **å°çº¢ä¹¦è§£æ**: æå–æ ‡é¢˜ã€ä½œè€…ã€æ­£æ–‡ã€å›¾ç‰‡å’Œè§†é¢‘ï¼Œæ”¯æŒå›¾æ–‡ã€è§†é¢‘ã€Liveå›¾ç­‰å¤šç§å†…å®¹ç±»å‹
- **æŠ–éŸ³è§£æ**: è§£æè§†é¢‘å’Œå›¾é›†å†…å®¹ï¼Œæå–æ— æ°´å°è§†é¢‘é“¾æ¥ï¼Œæ”¯æŒLiveå›¾è¯†åˆ«
- **æ™ºèƒ½é“¾æ¥æå–**: ä»åˆ†äº«æ–‡æœ¬ä¸­è‡ªåŠ¨è¯†åˆ«å¹¶æå–å°çº¢ä¹¦/æŠ–éŸ³é“¾æ¥

### ğŸ¬ æ™ºèƒ½åª’ä½“å¤„ç†
- **é˜²ç›—é“¾è§£å†³**: ä¸‹è½½åŸå§‹åª’ä½“æ–‡ä»¶ï¼Œè§£å†³å¹³å°é˜²ç›—é“¾é—®é¢˜
- **æ ¼å¼ä¼˜åŒ–**: ä¼˜å…ˆé€‰æ‹©JPEGæ ¼å¼ï¼Œç¡®ä¿Notionå…¼å®¹æ€§ï¼Œé¿å…WebPæ ¼å¼é—®é¢˜
- **æ™ºèƒ½å­˜å‚¨**: æ ¹æ®æ–‡ä»¶å¤§å°è‡ªåŠ¨é€‰æ‹©å­˜å‚¨æ–¹å¼ï¼ˆå›¾åºŠ vs CDNä»£ç†ï¼‰
- **æ‰¹é‡å¤„ç†**: ä¼˜åŒ–çš„æ‰¹æ¬¡å¤„ç†æœºåˆ¶ï¼Œé¿å…è¯·æ±‚è¿‡è½½
- **CDNä»£ç†**: å¤§æ–‡ä»¶è‡ªåŠ¨ä½¿ç”¨CDNä»£ç†ï¼Œæå‡è®¿é—®é€Ÿåº¦

### ğŸ“ Notioné›†æˆ
- **è‡ªåŠ¨åŒæ­¥**: è§£æå†…å®¹ç›´æ¥åŒæ­¥åˆ°Notionæ•°æ®åº“
- **æ™ºèƒ½æ ‡ç­¾**: è‡ªåŠ¨ç”Ÿæˆå¹³å°ã€å†…å®¹ç±»å‹ã€Liveå›¾ç­‰æ ‡ç­¾
- **åª’ä½“å±•ç¤º**: å›¾ç‰‡ã€è§†é¢‘åœ¨Notionä¸­å®Œç¾å±•ç¤º
- **å°é¢è®¾ç½®**: è‡ªåŠ¨è®¾ç½®é¡µé¢å°é¢å›¾ç‰‡

### ğŸ›ï¸ ä¸“ä¸šæ—¥å¿—ç³»ç»Ÿ
- **ç¯å¢ƒæ„ŸçŸ¥**: ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨å‡å°‘æ—¥å¿—è¾“å‡ºï¼Œå¼€å‘ç¯å¢ƒè¯¦ç»†è°ƒè¯•
- **åˆ†çº§æ—¥å¿—**: DEBUGã€INFOã€WARNã€ERROR å››çº§æ—¥å¿—ç®¡ç†
- **åˆ†ç±»æ—¥å¿—**: åª’ä½“å¤„ç†ã€Liveå›¾ã€è§£æã€åŒæ­¥ç­‰ä¸“é—¨æ—¥å¿—æ–¹æ³•
- **æ€§èƒ½ä¼˜åŒ–**: é¿å…ä¸å¿…è¦çš„æ—¥å¿—è®¡ç®—ï¼Œæå‡è¿è¡Œæ•ˆç‡
- **ç¯å¢ƒå˜é‡æ§åˆ¶**: é€šè¿‡ `LOG_LEVEL` ç¯å¢ƒå˜é‡çµæ´»æ§åˆ¶

### âš™ï¸ é…ç½®åŒ–ç®¡ç†
- **ç»Ÿä¸€é…ç½®**: æ‰€æœ‰ç¡¬ç¼–ç å€¼ç§»åˆ°é…ç½®æ–‡ä»¶ï¼Œä¾¿äºç»´æŠ¤
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- **æ‰¹æ¬¡ä¼˜åŒ–**: å¯é…ç½®çš„æ‰¹æ¬¡å¤§å°å’Œå»¶è¿Ÿæ—¶é—´
- **å­˜å‚¨ç­–ç•¥**: çµæ´»çš„æ–‡ä»¶å¤§å°é˜ˆå€¼å’Œå­˜å‚¨é€‰æ‹©

## ğŸ› ï¸ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **è¿è¡Œç¯å¢ƒ**: Cloudflare Workers (Edge Computing)
- **å¼€å‘è¯­è¨€**: TypeScript (ES6+è¯­æ³•)
- **è·¯ç”±æ¡†æ¶**: itty-router
- **å­˜å‚¨æœåŠ¡**: Cloudflare KV + R2 + TG-Imageå›¾åºŠ
- **APIé›†æˆ**: Notion API
- **æ—¥å¿—ç³»ç»Ÿ**: ç¯å¢ƒæ„ŸçŸ¥çš„åˆ†çº§æ—¥å¿—ç³»ç»Ÿ
- **é…ç½®ç®¡ç†**: ç±»å‹å®‰å…¨çš„é…ç½®åŒ–ç®¡ç†

### é¡¹ç›®ç»“æ„
```
src/
â”œâ”€â”€ index.ts           # ä¸»å…¥å£ï¼ŒHTTPè·¯ç”±å¤„ç†
â”œâ”€â”€ xiaohongshuParser.ts # å°çº¢ä¹¦å†…å®¹è§£æå™¨
â”œâ”€â”€ douyinParser.ts    # æŠ–éŸ³å†…å®¹è§£æå™¨
â”œâ”€â”€ media.ts           # åª’ä½“æ–‡ä»¶å¤„ç†æ ¸å¿ƒ
â”œâ”€â”€ imageHost.ts       # å›¾åºŠæœåŠ¡æ¥å£
â”œâ”€â”€ notionSync.ts      # NotionåŒæ­¥æ ¸å¿ƒ
â”œâ”€â”€ config.ts          # ç³»ç»Ÿé…ç½®ç®¡ç†
â”œâ”€â”€ logger.ts          # ç»Ÿä¸€æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ proxyUrl.ts        # CDNä»£ç†URLç”Ÿæˆ
â””â”€â”€ utils.ts           # é€šç”¨å·¥å…·å‡½æ•°
```

## ğŸ“‹ å‰ç½®æ¡ä»¶

- Cloudflare è´¦å·ï¼ˆWorkers + KV + R2ï¼‰
- Notion è´¦å·å’Œ API Token
- TG-Image å›¾åºŠè´¦å·ï¼ˆå¯é€‰ï¼‰
- Wrangler CLI å·¥å…·

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/blurmood/SyncToNotion.git
cd SyncToNotion
```

### 2. å®‰è£…ä¾èµ–
```bash
npm install
```

### 3. é…ç½®ç¯å¢ƒ

ç¼–è¾‘ `wrangler.toml` æ–‡ä»¶ï¼Œé…ç½®æ‚¨çš„èµ„æºï¼š

```toml
# KVå‘½åç©ºé—´
kv_namespaces = [
  { binding = "CACHE_KV", id = "your-kv-namespace-id" }
]

# R2å­˜å‚¨æ¡¶
[[r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "your-bucket-name"

# ç¯å¢ƒå˜é‡
[vars]
ADMIN_KEY = "your-admin-key"
IMAGE_HOST_USERNAME = "your-image-host-username"
IMAGE_HOST_PASSWORD = "your-image-host-password"
LOG_LEVEL = "WARN"  # ç”Ÿäº§ç¯å¢ƒæ¨è WARNï¼Œå¼€å‘ç¯å¢ƒå¯ç”¨ DEBUG
```

### 4. é…ç½®Notioné›†æˆ

åœ¨ `src/config.ts` ä¸­é…ç½®æ‚¨çš„Notionä¿¡æ¯ï¼š

```typescript
export const NOTION_CONFIG = {
  TOKEN: 'your-notion-integration-token',
  DATABASE_ID: 'your-database-id',
  // ... å…¶ä»–é…ç½®
};
```

### 5. æ„å»ºå’Œéƒ¨ç½²
```bash
# æ„å»ºTypeScript
npm run build

# éƒ¨ç½²åˆ°Cloudflare Workers
npm run deploy
```

## ğŸ“– APIä½¿ç”¨æŒ‡å—

### ğŸ” å†…å®¹è§£æAPI

#### è§£æå°çº¢ä¹¦/æŠ–éŸ³é“¾æ¥
```http
GET /parse?url={é“¾æ¥åœ°å€}&refresh={æ˜¯å¦å¼ºåˆ¶åˆ·æ–°}
```

**å‚æ•°è¯´æ˜:**
- `url`: å°çº¢ä¹¦æˆ–æŠ–éŸ³é“¾æ¥
- `refresh`: å¯é€‰ï¼Œ`true`æ—¶å¼ºåˆ¶åˆ·æ–°ç¼“å­˜

**ç¤ºä¾‹è¯·æ±‚:**
```bash
curl "https://your-worker.your-subdomain.workers.dev/parse?url=https://www.xiaohongshu.com/explore/xxx"
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "title": "ç¤ºä¾‹æ ‡é¢˜",
  "author": {
    "name": "ä½œè€…æ˜µç§°",
    "id": "ä½œè€…ID",
    "avatar": "https://processed-avatar-url.jpg"
  },
  "content": "æ­£æ–‡å†…å®¹...",
  "images": [
    "https://processed-image-url-1.jpg",
    "https://processed-image-url-2.jpg"
  ],
  "video": "https://processed-video-url.mp4",
  "stats": {
    "likes": 1000,
    "comments": 50,
    "collects": 30,
    "shares": 20
  },
  "original_url": "https://www.xiaohongshu.com/explore/xxx",
  "parsed_at": "2024-12-18T12:00:00Z",
  "_cache": "hit"
}
```

### ğŸ”— é“¾æ¥æå–API

#### ä»æ–‡æœ¬æå–é“¾æ¥
```http
POST /extract-link
Content-Type: application/json

{
  "text": "åˆ†äº«æ–‡æœ¬å†…å®¹"
}
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "found": true,
  "link": "https://xhslink.com/xxx",
  "platform": "å°çº¢ä¹¦",
  "original_text": "åŸå§‹åˆ†äº«æ–‡æœ¬"
}
```

### ğŸ“ NotionåŒæ­¥APIï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

#### ä»æ–‡æœ¬ç›´æ¥åŒæ­¥åˆ°Notion
```http
POST /sync-from-text
Content-Type: application/json

{
  "text": "åŒ…å«å°çº¢ä¹¦/æŠ–éŸ³é“¾æ¥çš„åˆ†äº«æ–‡æœ¬",
  "key": "your-admin-key",
  "tags": ["è‡ªå®šä¹‰æ ‡ç­¾1", "è‡ªå®šä¹‰æ ‡ç­¾2"]
}
```

**å‚æ•°è¯´æ˜:**
- `text`: åŒ…å«é“¾æ¥çš„åˆ†äº«æ–‡æœ¬
- `key`: ç®¡ç†å‘˜å¯†é’¥ï¼ˆå¿…éœ€ï¼‰
- `tags`: è‡ªå®šä¹‰æ ‡ç­¾æ•°ç»„ï¼ˆå¯é€‰ï¼‰

**ç¤ºä¾‹è¯·æ±‚:**
```bash
curl -X POST "https://your-worker.your-subdomain.workers.dev/sync-from-text" \
  -H "Content-Type: application/json" \
  -d '{
    "text": "48 æœºæ™ºæ˜ŸçƒXåšå£«å‘å¸ƒäº†ä¸€ç¯‡å°çº¢ä¹¦ç¬”è®°ï¼Œå¿«æ¥çœ‹å§ï¼ ğŸ˜† FrIaI2M8JntUjM9 ğŸ˜† http://xhslink.com/a/cEUvjvndbsAdbï¼Œå¤åˆ¶æœ¬æ¡ä¿¡æ¯ï¼Œæ‰“å¼€ã€å°çº¢ä¹¦ã€‘AppæŸ¥çœ‹ç²¾å½©å†…å®¹ï¼",
    "key": "your-admin-key",
    "tags": ["æ”¶è—", "å­¦ä¹ "]
  }'
```

**æˆåŠŸå“åº”:**
```json
{
  "message": "åŒæ­¥åˆ° Notion æˆåŠŸ",
  "extracted_link": "http://xhslink.com/a/cEUvjvndbsAdb",
  "platform": "å°çº¢ä¹¦",
  "notion_page_id": "8a9b7c6d-5e4f-3a2b-1c0d-9e8f7a6b5c4d",
  "notion_page_url": "https://www.notion.so/your-workspace/xxx",
  "applied_tags": ["å°çº¢ä¹¦", "å›¾æ–‡", "æ”¶è—", "å­¦ä¹ "],
  "video_processed": false,
  "video_processing": false,
  "video_url": null,
  "async_processing": false,
  "note": "åŒæ­¥å¤„ç†å®Œæˆ"
}
```

### ğŸ”§ ç®¡ç†API

#### å¥åº·æ£€æŸ¥
```http
GET /health
```

**å“åº”:**
```json
{
  "status": "ok",
  "timestamp": "2024-12-18T12:00:00Z"
}
```

#### åˆ·æ–°å›¾åºŠä»¤ç‰Œ
```http
GET /admin/refresh-token?key=your-admin-key
```

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§è¯¦è§£

### æ™ºèƒ½å†…å®¹è¯†åˆ«
- **å¤šå¹³å°æ”¯æŒ**: è‡ªåŠ¨è¯†åˆ«å°çº¢ä¹¦å’ŒæŠ–éŸ³é“¾æ¥
- **å†…å®¹ç±»å‹æ£€æµ‹**: å›¾æ–‡ã€è§†é¢‘ã€Liveå›¾è‡ªåŠ¨åˆ†ç±»
- **æ ¼å¼ä¼˜åŒ–**: ä¼˜å…ˆé€‰æ‹©JPEGæ ¼å¼ï¼Œç¡®ä¿Notionå…¼å®¹æ€§

### é«˜æ•ˆåª’ä½“å¤„ç†
- **é˜²ç›—é“¾è§£å†³**: ä¸‹è½½å¹¶é‡æ–°æ‰˜ç®¡æ‰€æœ‰åª’ä½“æ–‡ä»¶
- **æ™ºèƒ½å­˜å‚¨ç­–ç•¥**:
  - å°æ–‡ä»¶(< 19MB): TG-Imageå›¾åºŠ
  - å¤§æ–‡ä»¶(â‰¥ 19MB): Cloudflare R2å­˜å‚¨
- **å¹¶å‘å¤„ç†**: å¤šåª’ä½“æ–‡ä»¶åŒæ—¶å¤„ç†ï¼Œæå‡æ•ˆç‡
- **æ ¼å¼è½¬æ¢**: WebPè‡ªåŠ¨è½¬æ¢ä¸ºJPG

### Notionæ·±åº¦é›†æˆ
- **æ™ºèƒ½æ ‡ç­¾ç³»ç»Ÿ**:
  - å¹³å°æ ‡ç­¾: å°çº¢ä¹¦ã€æŠ–éŸ³
  - å†…å®¹ç±»å‹: å›¾æ–‡ã€è§†é¢‘ã€å®å†µå›¾ç‰‡
  - è‡ªå®šä¹‰æ ‡ç­¾: ç”¨æˆ·å¯æ·»åŠ ä¸ªæ€§åŒ–æ ‡ç­¾
- **å®Œç¾å±•ç¤º**: å›¾ç‰‡ã€è§†é¢‘åœ¨Notionä¸­åŸç”Ÿå±•ç¤º
- **å°é¢è®¾ç½®**: è‡ªåŠ¨è®¾ç½®é¡µé¢å°é¢å›¾ç‰‡

### ä¼ä¸šçº§å¯é æ€§
- **ç¼“å­˜æœºåˆ¶**: KVå­˜å‚¨é¿å…é‡å¤å¤„ç†
- **é”™è¯¯é‡è¯•**: ç½‘ç»œè¯·æ±‚å’Œæ–‡ä»¶ä¸Šä¼ è‡ªåŠ¨é‡è¯•
- **é™çº§å¤„ç†**: å¤šå±‚é™çº§ç­–ç•¥ï¼Œç¡®ä¿æœåŠ¡å¯ç”¨æ€§
- **æƒé™æ§åˆ¶**: ç®¡ç†å‘˜å¯†é’¥ä¿æŠ¤APIå®‰å…¨
- **æ€§èƒ½ç›‘æ§**: ä¸“ä¸šæ—¥å¿—ç³»ç»Ÿï¼Œä¾¿äºæ€§èƒ½åˆ†æå’Œé—®é¢˜æ’æŸ¥

## ğŸš€ æœ€æ–°ç‰¹æ€§ (v2.0)

### ğŸ›ï¸ ä¸“ä¸šæ—¥å¿—ç³»ç»Ÿ
- **ç¯å¢ƒæ„ŸçŸ¥**: ç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨ä¼˜åŒ–æ—¥å¿—è¾“å‡ºï¼Œå‡å°‘çº¦80%çš„æ—¥å¿—é‡
- **åˆ†ç±»æ—¥å¿—**: åª’ä½“ã€Liveå›¾ã€è§£æã€åŒæ­¥ç­‰12ç§ä¸“é—¨æ—¥å¿—æ–¹æ³•
- **æ€§èƒ½æå‡**: é¿å…ä¸å¿…è¦çš„å­—ç¬¦ä¸²æ‹¼æ¥å’Œæ—¥å¿—è®¡ç®—
- **è°ƒè¯•å‹å¥½**: å¼€å‘ç¯å¢ƒæä¾›è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯

### âš™ï¸ é…ç½®åŒ–ç®¡ç†
- **ç»Ÿä¸€é…ç½®**: æ‰€æœ‰ç¡¬ç¼–ç å€¼ç§»åˆ°é…ç½®æ–‡ä»¶ï¼Œæå‡å¯ç»´æŠ¤æ€§
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- **çµæ´»è°ƒæ•´**: æ‰¹æ¬¡å¤§å°ã€å»¶è¿Ÿæ—¶é—´ã€æ–‡ä»¶é˜ˆå€¼ç­‰å¯é…ç½®

### ğŸ”§ ä»£ç è´¨é‡æå‡
- **æ¸…æ´ä»£ç **: ç§»é™¤äº†267ä¸ªconsoleè¯­å¥ï¼Œä»£ç æ›´åŠ æ•´æ´
- **æ¨¡å—åŒ–**: æ›´å¥½çš„ä»£ç ç»„ç»‡å’Œæ¨¡å—åˆ’åˆ†
- **é”™è¯¯å¤„ç†**: æ›´å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶

## âš ï¸ ä½¿ç”¨é¡»çŸ¥

### åˆè§„ä½¿ç”¨
- ä»…ä¾›ä¸ªäººå­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨
- è¯·éµå®ˆç›¸å…³å¹³å°çš„ä½¿ç”¨æ¡æ¬¾
- ä¸å¾—ç”¨äºå•†ä¸šç”¨é€”æˆ–å¤§è§„æ¨¡æ•°æ®é‡‡é›†
- è¯·å°Šé‡åŸåˆ›ä½œè€…çš„ç‰ˆæƒ

### æŠ€æœ¯é™åˆ¶
- ä¾èµ–ç¬¬ä¸‰æ–¹å¹³å°APIï¼Œå¯èƒ½å—åˆ°é™åˆ¶
- åª’ä½“æ–‡ä»¶å¤„ç†æœ‰å¤§å°é™åˆ¶
- éœ€è¦ç¨³å®šçš„ç½‘ç»œç¯å¢ƒ

## ğŸ“ˆ ç‰ˆæœ¬å†å²

### v2.0.0 (2024-12-19)
- âœ¨ **æ–°å¢**: ä¸“ä¸šæ—¥å¿—ç³»ç»Ÿï¼Œæ”¯æŒç¯å¢ƒæ„ŸçŸ¥å’Œåˆ†çº§æ—¥å¿—
- âœ¨ **æ–°å¢**: é…ç½®åŒ–ç®¡ç†ï¼Œæ‰€æœ‰å‚æ•°å¯é…ç½®
- âœ¨ **æ–°å¢**: CDNä»£ç†åŠŸèƒ½ï¼Œæ”¯æŒå¤§æ–‡ä»¶ä»£ç†è®¿é—®
- ğŸ”§ **ä¼˜åŒ–**: æ‰¹é‡å¤„ç†æœºåˆ¶ï¼Œé¿å…è¯·æ±‚è¿‡è½½
- ğŸ”§ **ä¼˜åŒ–**: ä»£ç è´¨é‡æå‡ï¼Œç§»é™¤267ä¸ªconsoleè¯­å¥
- ğŸ”§ **ä¼˜åŒ–**: é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
- ğŸ› **ä¿®å¤**: Liveå›¾å¤„ç†çš„ç¨³å®šæ€§é—®é¢˜

### v1.0.0 (2024-12-18)
- ğŸ‰ **å‘å¸ƒ**: åŸºç¡€åŠŸèƒ½å®Œæ•´å®ç°
- âœ¨ **æ”¯æŒ**: å°çº¢ä¹¦å’ŒæŠ–éŸ³å†…å®¹è§£æ
- âœ¨ **æ”¯æŒ**: Notionè‡ªåŠ¨åŒæ­¥
- âœ¨ **æ”¯æŒ**: æ™ºèƒ½åª’ä½“å¤„ç†

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ MIT åè®®å¼€æºï¼Œè¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## âš™ï¸ é«˜çº§é…ç½®

### å­˜å‚¨é…ç½®è¯¦è§£

#### Cloudflare R2 å­˜å‚¨
```toml
# wrangler.toml
[[r2_buckets]]
binding = "MEDIA_BUCKET"
bucket_name = "your-bucket-name"
```

#### TG-Image å›¾åºŠé…ç½®
```toml
# wrangler.toml
[vars]
IMAGE_HOST_USERNAME = "your-username"
IMAGE_HOST_PASSWORD = "your-password"
```

### Notioné…ç½®

åœ¨ `src/config.ts` ä¸­é…ç½®Notioné›†æˆï¼š

```typescript
export const NOTION_CONFIG = {
  TOKEN: 'secret_xxxxxxxxxx',
  DATABASE_ID: 'your-database-id',
  PROPERTIES: {
    TITLE: 'æ ‡é¢˜',
    AUTHOR: 'ä½œè€…',
    ORIGINAL_URL: 'åŸå¸–é“¾æ¥',
    TAGS: 'æ ‡ç­¾',
    CREATED_TIME: 'åˆ›å»ºæ—¶é—´'
  }
};
```

### æ™ºèƒ½å­˜å‚¨ç­–ç•¥

ç³»ç»Ÿæ ¹æ®æ–‡ä»¶å¤§å°è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜å­˜å‚¨æ–¹æ¡ˆï¼š

| æ–‡ä»¶å¤§å° | å­˜å‚¨æ–¹å¼ | ç‰¹ç‚¹ |
|---------|---------|------|
| < 19MB | TG-Imageå›¾åºŠ | å¿«é€Ÿä¸Šä¼ ï¼ŒCDNåŠ é€Ÿ |
| 19MB - 110MB | TG-Imageå›¾åºŠï¼ˆåˆ†ç‰‡ä¸Šä¼ ï¼‰ | æ”¯æŒå¤§æ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ†ç‰‡ |
| â‰¥ 110MB | CDNä»£ç† | ä»£ç†è®¿é—®ï¼ŒèŠ‚çœå­˜å‚¨æˆæœ¬ |

### é…ç½®åŒ–å‚æ•°

æ‰€æœ‰å…³é”®å‚æ•°éƒ½å¯åœ¨ `src/config.ts` ä¸­é…ç½®ï¼š

```typescript
export const MEDIA_PROCESSING_CONFIG = {
  // å»¶è¿Ÿé…ç½®ï¼ˆæ¯«ç§’ï¼‰
  DELAYS: {
    BATCH_INTERVAL: 300,      // æ‰¹æ¬¡é—´å»¶è¿Ÿ
    IMAGE_INTERVAL: 100,      // å›¾ç‰‡é—´å»¶è¿Ÿ
    VIDEO_INTERVAL: 200,      // è§†é¢‘é—´å»¶è¿Ÿ
    LIVE_PHOTO_INTERVAL: 200  // Liveå›¾è§†é¢‘é—´å»¶è¿Ÿ
  },

  // æ‰¹æ¬¡å¤§å°é…ç½®
  BATCH_SIZES: {
    IMAGES: 12,  // å›¾ç‰‡æ‰¹æ¬¡å¤§å°
    VIDEOS: 8    // è§†é¢‘æ‰¹æ¬¡å¤§å°
  },

  // æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆå­—èŠ‚ï¼‰
  SIZE_LIMITS: {
    IMAGE_HOST_THRESHOLD: 19 * 1024 * 1024,   // 19MB
    PROXY_THRESHOLD: 110 * 1024 * 1024        // 110MB
  }
};
```

### åª’ä½“å¤„ç†æµç¨‹

1. **æ™ºèƒ½æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«å†…å®¹ç±»å‹ï¼ˆå›¾æ–‡ã€è§†é¢‘ã€Liveå›¾ï¼‰
2. **æ‰¹é‡å¤„ç†**: æ ¹æ®é…ç½®è¿›è¡Œæ‰¹æ¬¡å¤„ç†ï¼Œé¿å…è¯·æ±‚è¿‡è½½
3. **æ ¼å¼ä¼˜åŒ–**: ä¼˜å…ˆé€‰æ‹©JPEGï¼Œé¿å…WebPå…¼å®¹æ€§é—®é¢˜
4. **æ™ºèƒ½å­˜å‚¨**: æ ¹æ®æ–‡ä»¶å¤§å°è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜å­˜å‚¨æ–¹æ¡ˆ
5. **CDNä»£ç†**: å¤§æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆä»£ç†URLï¼Œæå‡è®¿é—®é€Ÿåº¦
6. **éªŒè¯æœºåˆ¶**: ç¡®ä¿å¤„ç†åé“¾æ¥æœ‰æ•ˆå¯è®¿é—®
7. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é‡è¯•å’Œé™çº§æœºåˆ¶

### ç¼“å­˜ç­–ç•¥

- **KVç¼“å­˜**: è§£æç»“æœç¼“å­˜24å°æ—¶
- **å¼ºåˆ¶åˆ·æ–°**: æ·»åŠ `refresh=true`å‚æ•°
- **ç¼“å­˜é”®**: åŸºäºå¹³å°å’ŒURLç”Ÿæˆå”¯ä¸€é”®

## ğŸ”§ å¼€å‘æŒ‡å—

### æœ¬åœ°å¼€å‘

```bash
# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æ¨¡å¼
npm run dev

# ç±»å‹æ£€æŸ¥
npm run type-check

# æ„å»ºé¡¹ç›®
npm run build
```

### æµ‹è¯•éƒ¨ç½²

```bash
# éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ
wrangler deploy --env dev

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
wrangler deploy
```

### æ—¥å¿—ç³»ç»Ÿ

#### ç¯å¢ƒå˜é‡æ§åˆ¶
```bash
# å¼€å‘ç¯å¢ƒ - æ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—
LOG_LEVEL=DEBUG

# ç”Ÿäº§ç¯å¢ƒ - åªæ˜¾ç¤ºè­¦å‘Šå’Œé”™è¯¯ï¼ˆæ¨èï¼‰
LOG_LEVEL=WARN

# å®Œå…¨é™é»˜
LOG_LEVEL=NONE
```

#### æ—¥å¿—çº§åˆ«è¯´æ˜
- **DEBUG**: è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¤„ç†æ­¥éª¤ã€å‚æ•°ç­‰
- **INFO**: ä¸€èˆ¬ä¿¡æ¯ï¼Œå¦‚æ“ä½œæˆåŠŸã€è¿›åº¦ç­‰
- **WARN**: è­¦å‘Šä¿¡æ¯ï¼Œå¦‚é™çº§å¤„ç†ã€éå…³é”®é”™è¯¯ç­‰
- **ERROR**: é”™è¯¯ä¿¡æ¯ï¼Œå¦‚å¤„ç†å¤±è´¥ã€å¼‚å¸¸ç­‰

#### ä¸“ç”¨æ—¥å¿—æ–¹æ³•
```typescript
import { log } from './logger.js';

log.media('å¤„ç†åª’ä½“æ–‡ä»¶...');           // ğŸ¬ åª’ä½“å¤„ç†
log.livePhoto('Liveå›¾å¤„ç†å®Œæˆ');        // ğŸ“¸ Liveå›¾å¤„ç†
log.parse('å¼€å§‹è§£æå†…å®¹');              // ğŸ” è§£æå¤„ç†
log.sync('åŒæ­¥åˆ°Notion');              // ğŸ“ åŒæ­¥å¤„ç†
log.success('æ“ä½œæˆåŠŸ');               // âœ… æˆåŠŸæ—¥å¿—
log.failure('æ“ä½œå¤±è´¥', error);        // âŒ å¤±è´¥æ—¥å¿—
log.progress(5, 10, 'å¤„ç†è¿›åº¦');       // ğŸ“Š è¿›åº¦æ—¥å¿—
log.batch(1, 3, 'æ‰¹æ¬¡å¤„ç†');          // ğŸ“¦ æ‰¹å¤„ç†æ—¥å¿—
log.network('ç½‘ç»œè¯·æ±‚');               // ğŸŒ ç½‘ç»œæ—¥å¿—
log.cache('ç¼“å­˜æ“ä½œ');                 // ğŸ’¾ ç¼“å­˜æ—¥å¿—
log.config('é…ç½®æ›´æ–°');                // âš™ï¸ é…ç½®æ—¥å¿—
```

#### å®æ—¶æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
wrangler tail

# æŸ¥çœ‹ç‰¹å®šç¯å¢ƒçš„æ—¥å¿—
wrangler tail --env production
```
